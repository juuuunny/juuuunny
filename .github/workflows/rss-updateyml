name: Update README with Velog Posts

on:
  schedule:
    - cron: '0 * * * *' # 매 시간마다 업데이트 (원하는 주기로 수정 가능)
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Pull Velog RSS feed and update README
        uses: actions/github-script@v3
        with:
          script: |
            const { data: feed } = await require('@extractus/feed-extractor')('https://v2.velog.io/rss/@juuuunny');
            const fs = require('fs');
            const readmeContent = fs.readFileSync('README.md', 'utf-8');
            const startMarker = '<!--START_SECTION:velog-->';
            const endMarker = '<!--END_SECTION:velog-->';
            const latestPosts = feed.entries.slice(0, 5).map(post => `- [${post.title}](${post.link})`).join('\n');
            const updatedReadme = readmeContent.split(startMarker)[0] + startMarker + '\n' + latestPosts + '\n' + endMarker + readmeContent.split(endMarker)[1];
            fs.writeFileSync('README.md', updatedReadme);

      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Update recent Velog posts"
          git push
